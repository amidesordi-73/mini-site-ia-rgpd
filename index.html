<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini‚Äësite IA Act & RGPD ‚Äî Tests de prompts</title>
  <style>
    :root{
      /* Th√®me clair */
      --bg:#f8fafc;           /* slate-50 */
      --panel:#ffffff;        /* white */
      --muted:#475569;        /* slate-600 */
      --text:#0f172a;         /* slate-900 */
      --brand:#7c3aed;        /* violet-600 */
      --brand-2:#0891b2;      /* cyan-600 */
      --ok:#16a34a;           /* green-600 */
      --ko:#dc2626;           /* red-600 */
      --warn:#d97706;         /* amber-600 */
      --card:#ffffff;
      --accent:#e2e8f0;       /* slate-200 */
      --ring: 0 0 0 3px rgba(124,58,237,.25);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(124,58,237,.10), transparent 60%),
        radial-gradient(1200px 800px at 110% 10%, rgba(8,145,178,.08), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.1) blur(6px);
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));
      border-bottom:1px solid var(--accent);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:18px 20px}
    .title{ display:flex; align-items:center; gap:14px; flex-wrap:wrap; }
    .badge{font-size:12px; padding:4px 8px; border-radius:9999px; background:rgba(124,58,237,.10); color:#4338ca; border:1px solid rgba(124,58,237,.25)}
    nav{margin-top:12px; display:flex; gap:8px; flex-wrap:wrap}
    nav button{background:var(--panel); border:1px solid var(--accent); color:#1f2937; padding:10px 14px; border-radius:10px; cursor:pointer}
    nav button.active{background:linear-gradient(180deg,#ffffff,#f1f5f9); border-color:#cbd5e1; box-shadow:var(--ring)}

    main{padding:28px 20px}
    section[hidden]{display:none}
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
    .card{grid-column:span 12; background:linear-gradient(180deg,#ffffff,#f8fafc); border:1px solid var(--accent); border-radius:var(--radius); box-shadow:0 10px 30px rgba(2,6,23,.06)}
    .card h2{margin:0 0 12px 0; font-size:22px}
    .card h3{margin:0 0 8px 0; font-size:18px}
    .card .hdr{padding:18px 18px 0 18px}
    .card .cnt{padding:18px}
    .muted{color:var(--muted)}

    .two{grid-template-columns:repeat(12,1fr)}
    .two .col{grid-column:span 12}
    @media(min-width:860px){ .two .col-7{grid-column:span 7} .two .col-5{grid-column:span 5} }

    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid #c7d2fe; background:#eef2ff; color:#3730a3; font-size:14px}
    .list{display:grid; gap:12px}
    .q{padding:14px; border:1px solid var(--accent); border-radius:12px; background:#f8fafc}
    .q .choices{display:grid; gap:8px; margin-top:10px}
    .q label{display:flex; gap:10px; align-items:flex-start; cursor:pointer}
    .q input{margin-top:2px}

    .btn{appearance:none; border:none; background:linear-gradient(180deg,#7c3aed,#5b21b6); color:white; padding:10px 14px; border-radius:10px; cursor:pointer}
    .btn.secondary{background:#ffffff; color:#1f2937; border:1px solid var(--accent)}
    .btn.ghost{background:transparent; border:1px dashed #94a3b8; color:#334155}
    .btn.bad{background:linear-gradient(180deg,#ef4444,#b91c1c)}
    .btn.good{background:linear-gradient(180deg,#16a34a,#166534)}
    .inline{display:inline-flex; gap:10px; flex-wrap:wrap}

    .feedback{margin-top:10px; padding:10px 12px; border-radius:10px; font-size:14px}
    .ok{background:rgba(22,163,74,.10); border:1px solid rgba(22,163,74,.25)}
    .ko{background:rgba(220,38,38,.10); border:1px solid rgba(220,38,38,.25)}
    .hint{background:rgba(217,119,6,.10); border:1px solid rgba(217,119,6,.25)}

    textarea{width:100%; min-height:150px; resize:vertical; border-radius:12px; border:1px solid var(--accent); background:#ffffff; color:var(--text); padding:12px}
    input[type="text"], input[type="number"], select{width:100%; border-radius:10px; border:1px solid var(--accent); background:#ffffff; color:var(--text); padding:10px}

    .rule{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    .tag{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid #e9d5ff; background:#f5f3ff; font-size:12px; color:#6d28d9}
    .score{font-weight:700; font-size:18px}

    footer{margin-top:32px; border-top:1px solid var(--accent); color:#475569}
    a{color:#6d28d9}
    .small{font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.77 5.82 22 7 14.14l-5-4.87 6.91-1.01L12 2z" stroke="#7c3aed" fill="none" stroke-width="1.2"/>
        </svg>
        <div>
          <div style="font-size:20px; font-weight:700">IA Act & RGPD ‚Äî Tests de prompts</div>
          <div class="muted small">Mini‚Äësite p√©dagogique ‚Äî version autonome (HTML/JS). Aucun suivi externe. Conforme √† un usage formation (non‚Äëjuridique).</div>
        </div>
        <span class="badge">Formateur/Apprenant¬∑ Mode local</span>
      </div>
      <nav aria-label="Navigation des sections">
        <button class="active" data-target="home">Accueil</button>
        <button data-target="quiz-ia">Quiz IA Act</button>
        <button data-target="quiz-rgpd">Quiz RGPD</button>
        <button data-target="analyzer">Analyseur de prompt</button>
        <button data-target="cases">Cas pratiques</button>
        <button data-target="results">R√©sultats</button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section id="home">
      <div class="card">
        <div class="hdr">
          <h2>Bienvenue üëã</h2>
          <p class="muted">Ce mini‚Äësite aide vos stagiaires √† reconna√Ætre les risques IA Act et RGPD dans des <em>prompts</em> et √† √©crire des consignes conformes (minimisation, transparence, s√©curit√©).</p>
        </div>
        <div class="cnt grid two">
          <div class="col col-7">
            <div class="list">
              <div class="pill">üß≠ Objectif 1 ¬∑ Identifier les cas d‚Äôusage √† risque (IA Act)</div>
              <div class="pill">üîê Objectif 2 ¬∑ D√©tecter les donn√©es personnelles / sensibles (RGPD)</div>
              <div class="pill">‚úçÔ∏è Objectif 3 ¬∑ R√©√©crire un prompt pour le rendre conforme</div>
            </div>
            <div style="margin-top:16px" class="inline">
              <button class="btn" data-go="quiz-ia">D√©marrer ‚Äî Quiz IA Act</button>
              <button class="btn secondary" data-go="analyzer">Tester un prompt</button>
            </div>
          </div>
          <div class="col col-5">
            <div class="q">
              <h3>R√®gles p√©dagogiques</h3>
              <ul>
                <li>Feedback imm√©diat + explications</li>
                <li>Score cumul√© par section et global</li>
                <li>Aucun envoi de donn√©es ‚Äî tout reste dans le navigateur</li>
              </ul>
              <div class="small muted">‚ö†Ô∏è Outil de formation. Pour un avis juridique, rapprochez‚Äëvous d‚Äôun sp√©cialiste.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="quiz-ia" hidden>
      <div class="card">
        <div class="hdr"><h2>Quiz IA Act (10 questions)</h2>
          <p class="muted">R√©pondez, puis cliquez ¬´ Valider ¬ª. Certaines questions ont plusieurs bonnes r√©ponses.</p></div>
        <div class="cnt list" id="quizIAContainer" aria-live="polite"></div>
        <div class="cnt inline">
          <button class="btn" id="validateIA">Valider</button>
          <button class="btn ghost" id="resetIA">R√©initialiser</button>
          <div class="score" id="scoreIA" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <section id="quiz-rgpd" hidden>
      <div class="card">
        <div class="hdr"><h2>Quiz RGPD (10 questions)</h2>
          <p class="muted">Cochez la/les bonne(s) r√©ponse(s). Feedback d√©taill√© √† la validation.</p></div>
        <div class="cnt list" id="quizRGPDContainer" aria-live="polite"></div>
        <div class="cnt inline">
          <button class="btn" id="validateRGPD">Valider</button>
          <button class="btn ghost" id="resetRGPD">R√©initialiser</button>
          <div class="score" id="scoreRGPD" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <section id="analyzer" hidden>
      <div class="card">
        <div class="hdr"><h2>Analyseur de prompt (IA Act & RGPD)</h2>
          <p class="muted">Collez un prompt. L‚Äôoutil d√©tecte les risques (donn√©es perso, cat√©gories sensibles, mineurs, profilage, biom√©trie‚Ä¶) et propose une r√©√©criture.</p></div>
        <div class="cnt grid two">
          <div class="col col-7">
            <label for="promptInput" class="small muted">Votre prompt</label>
            <textarea id="promptInput" placeholder="Ex.¬†: Analyse ces entretiens d‚Äôembauche en identifiant les meilleurs candidats (noms, emails, √¢ge, √©tat de sant√©). Donne une note sur 100."></textarea>
            <div class="inline" style="margin-top:10px">
              <button class="btn" id="analyzeBtn">Analyser</button>
              <button class="btn secondary" id="sampleBtn">Exemple</button>
            </div>
          </div>
          <div class="col col-5">
            <div class="q" id="analysisBox" aria-live="polite">
              <div class="muted">R√©sultats de l‚Äôanalyse s‚Äôaffichent ici.</div>
            </div>
          </div>
        </div>
        <div class="cnt">
          <h3>R√©√©criture assist√©e</h3>
          <p class="muted">Une proposition anonymis√©e et plus conforme est g√©n√©r√©e automatiquement.</p>
          <textarea id="rewriteBox" readonly placeholder="La r√©√©criture appara√Ætra ici apr√®s l‚Äôanalyse."></textarea>
          <div class="inline" style="margin-top:10px">
            <button class="btn good" id="copyRewrite">Copier la r√©√©criture</button>
            <button class="btn ghost" id="clearAnalyzer">Effacer</button>
          </div>
        </div>
      </div>
    </section>

    <section id="cases" hidden>
      <div class="card">
        <div class="hdr"><h2>Cas pratiques de prompts</h2>
          <p class="muted">Pour chaque cas, d√©cidez si le prompt est conforme. Puis affichez la correction.</p></div>
        <div class="cnt list" id="casesContainer"></div>
        <div class="cnt inline">
          <button class="btn" id="revealCases">Afficher toutes les corrections</button>
          <button class="btn ghost" id="resetCases">R√©initialiser</button>
        </div>
      </div>
    </section>

    <section id="results" hidden>
      <div class="card">
        <div class="hdr"><h2>R√©sultats & Suivi</h2></div>
        <div class="cnt">
          <div class="q">
            <div class="grid two">
              <div class="col col-7">
                <h3>Tableau de bord</h3>
                <p class="muted">Scores locaux (non envoy√©s). R√©initialisez pour un nouveau groupe.</p>
                <ul>
                  <li>Score IA Act¬†: <span id="boardIA">0/0</span></li>
                  <li>Score RGPD¬†: <span id="boardRGPD">0/0</span></li>
                  <li>Score total¬†: <span id="boardTotal">0/0</span></li>
                </ul>
              </div>
              <div class="col col-5">
                <h3>Actions rapides</h3>
                <div class="inline">
                  <button class="btn secondary" id="resetAll">Tout r√©initialiser</button>
                  <button class="btn" data-go="home">Retour √† l‚Äôaccueil</button>
                  <button class="btn ghost" id="runDiagnostics">Diagnostics</button>
                </div>
                <div id="diagnosticsPanel" class="small" style="margin-top:10px"></div>
              </div>
            </div>
          </div>
          <div class="small muted" style="margin-top:14px">Astuce : ouvrez ce fichier sur les postes apprenants. Les r√©sultats restent en local (session navigateur).</div>
        </div>
      </div>
      <footer class="wrap">
        <p class="small">¬© Votre organisme ‚Äî Mini‚Äësite p√©dagogique IA Act & RGPD. 
          <span class="muted">Personnalisez le pied de page et les couleurs au besoin.</span>
        </p>
      </footer>
    </section>
  </main>

  <script>
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // Navigation simple
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  const navButtons = document.querySelectorAll('nav button');
  const sections = document.querySelectorAll('main section');
  const goButtons = document.querySelectorAll('[data-go]');

  function showSection(id){
    sections.forEach(s => s.hidden = s.id !== id);
    navButtons.forEach(b => b.classList.toggle('active', b.dataset.target === id));
    // Assure l'initialisation dynamique des cas pratiques √† l'ouverture de l'onglet
    if(id === 'cases'){
      const cc = document.getElementById('casesContainer');
      if(cc && cc.children.length === 0){
        try{ renderCases(); }catch(e){ console.error('Render cases failed:', e); }
      }
    }
    window.scrollTo({top:0, behavior:'smooth'});
  }
  navButtons.forEach(b => b.addEventListener('click', () => showSection(b.dataset.target)));
  goButtons.forEach(b => b.addEventListener('click', () => showSection(b.dataset.go)));

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // Banque de questions (synth√®se formation)
  // Note : ces contenus simplifient le droit pour un usage p√©dagogique.
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  /** @type {{id:string, q:string, choices:string[], correct:number[], explain:string}[]} */
  const quizIA = [
    {id:'ia1', q:"Quelles pratiques sont g√©n√©ralement interdites par l‚ÄôIA Act (hors exceptions strictes) ?", choices:[
      "Reconnaissance faciale en temps r√©el dans l‚Äôespace public par des acteurs priv√©s",
      "Manipulation cognitive d√©lib√©r√©e de groupes vuln√©rables",
      "Syst√®mes de notation sociale par les autorit√©s publiques",
      "G√©n√©ration d‚Äôimages avec marquage d‚ÄôIA"], correct:[0,1,2], explain:"L‚ÄôIA Act encadre fortement certaines pratiques : manipulation cognitive, scoring social, et reconnaissance biom√©trique en temps r√©el dans l‚Äôespace public sont globalement prohib√©es (sauf quelques cas l√©gaux tr√®s encadr√©s). Le marquage d‚ÄôIA rel√®ve plut√¥t d‚Äôexigences de transparence, pas d‚Äôune interdiction."},
    {id:'ia2', q:"Un <em>chatbot</em> conversationnel d√©ploy√© sur un site doit‚Ä¶", choices:[
      "Signaler qu‚Äôil ne s‚Äôagit pas d‚Äôun humain (transparence)",
      "Recueillir syst√©matiquement le consentement <em>RGPD</em> pour toute question",
      "√ätre explicable au sens <em>IA Act</em> avec une documentation interne proportionn√©e",
      "Emp√™cher l‚Äôexport des conversations"], correct:[0,2], explain:"L‚ÄôIA Act impose notamment une obligation de transparence pour les syst√®mes d‚ÄôIA destin√©s √† interagir avec des humains. L‚Äôexplicabilit√©/documentation est attendue proportionnellement au risque. Le consentement RGPD d√©pend du traitement de donn√©es et de la base l√©gale choisie."},
    {id:'ia3', q:"Qu‚Äôest‚Äëce qui peut classer un usage en ‚Äò√† haut risque‚Äô ?", choices:[
      "Impact sur l‚Äôacc√®s √† l‚Äôemploi, l‚Äô√©ducation, les services essentiels",
      "Usage purement ludique sans donn√©es personnelles",
      "Fonctions de s√©curit√© produits (ex. dispositifs m√©dicaux)",
      "Syst√®mes de recommandation vid√©o grand public"], correct:[0,2], explain:"L‚ÄôIA √† haut risque inclut des domaines list√©s (acc√®s √† des services essentiels, s√©curit√© de produits, etc.). Un usage ludique grand public sans donn√©es sensibles n‚Äôest g√©n√©ralement pas ‚Äòhaut risque‚Äô."},
    {id:'ia4', q:"Pour un syst√®me ‚Äò√† haut risque‚Äô, l‚ÄôIA Act exige notamment‚Ä¶", choices:[
      "Gestion des risques, qualit√© des donn√©es, tra√ßabilit√©, documentation",
      "Z√©ro faux positifs tol√©r√©s",
      "Surveillance humaine et cybers√©curit√©",
      "Audit de conformit√© et marquage CE le cas √©ch√©ant"], correct:[0,2,3], explain:"Les exigences incluent la gestion des risques, la gouvernance des donn√©es, la surveillance humaine, la robustesse/cybers√©curit√©, la documentation et la conformit√© (marquage CE, etc.). Z√©ro faux positif n‚Äôest pas exig√© ‚Äî on parle plut√¥t de niveaux de performance d√©clar√©s et surveill√©s."},
    {id:'ia5', q:"Le filigranage/marquage de contenus g√©n√©r√©s par l‚ÄôIA sert‚Ä¶", choices:[
      "√Ä informer le public et faciliter la d√©tection",
      "√Ä rendre l‚ÄôIA ‚Äò√† faible risque‚Äô",
      "√Ä remplacer la base l√©gale RGPD",
      "√Ä lutter contre la d√©sinformation g√©n√©r√©e"], correct:[0,3], explain:"Le marquage am√©liore la transparence et aide contre la d√©sinformation. Il ne r√©duit pas en soi la cat√©gorie de risque ni ne remplace les exigences RGPD."},
    {id:'ia6', q:"Quelle affirmation est correcte ?", choices:[
      "Tout mod√®le de fondation est interdit en Europe",
      "Certains mod√®les doivent publier des informations techniques et respecter des obligations sp√©cifiques",
      "Les jeux de donn√©es d‚Äôentra√Ænement ‚Äòopen‚Äô dispensent de toute exigence",
      "Aucune exigence de s√©curit√© n‚Äôest requise pour les usages internes"], correct:[1], explain:"Les mod√®les de fondation (FMs) ont des obligations sp√©cifiques (documentation, s√©curit√©, rapports). Les autres affirmations sont incorrectes."},
    {id:'ia7', q:"Exemple d‚Äôobligation de transparence c√¥t√© utilisateur de l‚ÄôIA :", choices:[
      "Indiquer quand un contenu est g√©n√©r√© ou manipul√© par IA",
      "Fournir les poids du mod√®le",
      "Rendre publics tous les jeux d‚Äôentra√Ænement",
      "Informer en cas de deepfake"], correct:[0,3], explain:"La transparence c√¥t√© utilisateur inclut l‚Äôinformation sur les contenus g√©n√©r√©s/manipul√©s et les deepfakes. Les poids du mod√®le et datasets ne sont pas requis c√¥t√© utilisateur final."},
    {id:'ia8', q:"Dans un prompt de recrutement qui ‚Äònote‚Äô les profils sur 100‚Ä¶", choices:[
      "On touche potentiellement un cas d‚Äôusage √† haut risque (acc√®s √† l‚Äôemploi)",
      "Aucune exigence si le bar√®me est interne",
      "Il faut pr√©voir une surveillance humaine et √©viter les biais",
      "Le marquage IA dispense d‚Äô√©valuer l‚Äô√©quit√©"], correct:[0,2], explain:"Le recrutement peut relever de l‚ÄôIA √† haut risque : pr√©voir surveillance humaine, √©valuation des biais/√©quit√©, documentation et base l√©gale RGPD adapt√©e."},
    {id:'ia9', q:"La d√©tection des √©motions en milieu professionnel‚Ä¶", choices:[
      "Est encadr√©e voire prohib√©e selon les contextes",
      "Est toujours autoris√©e avec consentement",
      "Peut relever d‚Äôune pratique interdite par l‚ÄôIA Act",
      "Ne pose aucun probl√®me de vie priv√©e"], correct:[0,2], explain:"La reconnaissance des √©motions est particuli√®rement sensible et peut √™tre prohib√©e selon les contextes list√©s dans l‚ÄôIA Act."},
    {id:'ia10', q:"Que faire si un cas d‚Äôusage touche des mineurs ?", choices:[
      "Renforcer la transparence et la protection des donn√©es",
      "Consid√©rer l‚Äôint√©r√™t sup√©rieur de l‚Äôenfant",
      "Pas d‚Äôimpact r√©glementaire sp√©cifique",
      "Limiter la collecte au strict n√©cessaire"], correct:[0,1,3], explain:"Les mineurs exigent une vigilance accrue (int√©r√™t sup√©rieur de l‚Äôenfant, minimisation, transparence renforc√©e)."}
  ];

  const quizRGPD = [
    {id:'rg1', q:"Quel(s) principe(s) s‚Äôapplique(nt) √† tout prompt traitant des donn√©es personnelles ?", choices:[
      "Minimisation (uniquement les infos utiles)",
      "Exactitude des donn√©es",
      "Conservation illimit√©e par d√©faut",
      "Limitation des finalit√©s"], correct:[0,1,3], explain:"Principes RGPD cl√©s : finalit√©, minimisation, exactitude, limitation de conservation, s√©curit√©."},
    {id:'rg2', q:"Qu‚Äôest‚Äëce qu‚Äôune ‚Äòdonn√©e personnelle‚Äô ?", choices:[
      "Toute info se rapportant √† une personne identifi√©e ou identifiable",
      "Seulement le nom et le pr√©nom",
      "Un identifiant en ligne pouvant permettre l‚Äôidentification",
      "Uniquement les donn√©es sensibles"], correct:[0,2], explain:"Sont inclus noms, emails, identifiants en ligne, etc. Les donn√©es sensibles sont une sous‚Äëcat√©gorie particuli√®re."},
    {id:'rg3', q:"Cat√©gories particuli√®res (sensibles) :", choices:[
      "Sant√©, biom√©trie, opinions politiques, religion, orientation sexuelle‚Ä¶",
      "Couleur pr√©f√©r√©e",
      "Donn√©es syndicales",
      "Niveau de batterie du t√©l√©phone"], correct:[0,2], explain:"Les cat√©gories particuli√®res incluent sant√©, biom√©trie, opinions politiques, croyances religieuses, orientation sexuelle, appartenance syndicale, etc."},
    {id:'rg4', q:"Base(s) l√©gale(s) fr√©quente(s) pour des prompts en contexte pro :", choices:[
      "Int√©r√™t l√©gitime (apr√®s test de mise en balance)",
      "Ex√©cution d‚Äôun contrat",
      "Consentement par d√©faut pour tout",
      "Obligation l√©gale selon le cas"], correct:[0,1,3], explain:"La base l√©gale d√©pend du contexte. Le consentement n‚Äôest pas ‚Äòpar d√©faut‚Äô et doit √™tre libre et √©clair√©."},
    {id:'rg5', q:"Dans un prompt, citer des noms complets et emails :", choices:[
      "Est √† √©viter, pr√©f√©rer des identifiants anonymis√©s",
      "N√©cessite d‚Äô√©valuer la base l√©gale et la minimisation",
      "Ne concerne pas le RGPD si c‚Äôest en interne",
      "Peut exiger une information des personnes"], correct:[0,1,3], explain:"M√™me en interne, le RGPD s‚Äôapplique. Minimisez les donn√©es et informez les personnes si n√©cessaire."},
    {id:'rg6', q:"Quels risques en notant des candidats via l‚ÄôIA ?", choices:[
      "Biais/discrimination",
      "Profilage de personnes physiques",
      "Aucun si le mod√®le est open‚Äësource",
      "Atteinte potentielle aux droits (acc√®s, rectification)"], correct:[0,1,3], explain:"Le profilage et les biais sont des risques majeurs ; le caract√®re open‚Äësource du mod√®le ne supprime pas les obligations RGPD."},
    {id:'rg7', q:"Mesures de s√©curit√© de base :", choices:[
      "Contr√¥le d‚Äôacc√®s et journalisation",
      "Chiffrement en transit/au repos selon le risque",
      "Partage syst√©matique par e‚Äëmail",
      "Principe du moindre privil√®ge"], correct:[0,1,3], explain:"La s√©curit√© comprend contr√¥le d‚Äôacc√®s, chiffrement, moindre privil√®ge, etc. √âvitez les partages non s√©curis√©s."},
    {id:'rg8', q:"DPIA (analyse d‚Äôimpact) :", choices:[
      "Requise pour certains traitements √† risque √©lev√©",
      "Jamais n√©cessaire pour les prompts",
      "Peut √™tre d√©clench√©e par du profilage √† grande √©chelle",
      "Toujours remplac√©e par le consentement"], correct:[0,2], explain:"Une AIPD/DPIA est requise en cas de risque √©lev√© (ex. profilage √† grande √©chelle). Le consentement ne la remplace pas."},
    {id:'rg9', q:"Droits des personnes :", choices:[
      "Acc√®s, rectification, effacement, opposition, limitation",
      "Portabilit√© dans certains cas",
      "Aucun droit si l‚ÄôIA est utilis√©e",
      "Information sur les traitements"], correct:[0,1,3], explain:"Les droits RGPD restent applicables quel que soit l‚Äôoutil (IA incluse)."},
    {id:'rg10', q:"Donn√©es de mineurs dans un prompt :", choices:[
      "Prudence accrue, parfois consentement des titulaires de l‚Äôautorit√© parentale",
      "Aucune pr√©caution sp√©cifique",
      "Minimisation renforc√©e",
      "Interdiction absolue en Europe"], correct:[0,2], explain:"Les mineurs n√©cessitent des garanties renforc√©es. Pas d‚Äôinterdiction g√©n√©rale mais fortes pr√©cautions et bases l√©gales adapt√©es."}
  ];

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // G√©n√©ration des quiz
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  function renderQuiz(containerId, dataset){
    const el = document.getElementById(containerId);
    el.innerHTML = '';
    dataset.forEach((q, idx) => {
      const qEl = document.createElement('div');
      qEl.className = 'q';
      qEl.innerHTML = `
        <div><strong>Q${idx+1}. </strong><span>${q.q}</span></div>
        <div class="choices">
          ${q.choices.map((c, i)=>`
            <label><input type="checkbox" name="${q.id}" value="${i}"/> <span>${c}</span></label>
          `).join('')}
        </div>
        <div class="feedback" id="fb-${q.id}" hidden></div>
      `;
      el.appendChild(qEl);
    });
  }
  renderQuiz('quizIAContainer', quizIA);
  renderQuiz('quizRGPDContainer', quizRGPD);

  function validateQuiz(dataset, scoreBoxId){
    let good=0, total=dataset.length;
    dataset.forEach(q=>{
      const inputs = [...document.querySelectorAll(`input[name="${q.id}"]`)];
      const selected = inputs.filter(i=>i.checked).map(i=>+i.value).sort();
      const correct = [...q.correct].sort();
      const ok = JSON.stringify(selected)===JSON.stringify(correct);
      const fb = document.getElementById(`fb-${q.id}`);
      fb.hidden=false;
      fb.className = 'feedback ' + (ok? 'ok':'ko');
      if(ok){
        good++;
        fb.textContent = '‚úÖ Bonne r√©ponse ! ' + q.explain;
      } else {
        fb.innerHTML = '‚ùå R√©ponse incorrecte. <br><span class="muted">Attendu : ' + correct.map(i=>q.choices[i]).join('; ') + '</span><br>' + q.explain;
      }
      // verrouiller apr√®s validation
      inputs.forEach(i=>i.disabled=true);
    });
    document.getElementById(scoreBoxId).textContent = `Score : ${good}/${total}`;
    updateBoard();
  }

  function resetQuiz(dataset, containerId, scoreBoxId){
    dataset.forEach(q=>{
      const inputs = [...document.querySelectorAll(`input[name="${q.id}"]`)];
      inputs.forEach(i=>{ i.checked=false; i.disabled=false; });
      const fb = document.getElementById(`fb-${q.id}`);
      fb.hidden=true; fb.textContent=''; fb.className='feedback';
    });
    document.getElementById(scoreBoxId).textContent = '';
    // re-render (pour nettoyer tout √©cart)
    renderQuiz(containerId, dataset);
  }

  document.getElementById('validateIA').addEventListener('click', ()=>validateQuiz(quizIA,'scoreIA'));
  document.getElementById('validateRGPD').addEventListener('click', ()=>validateQuiz(quizRGPD,'scoreRGPD'));
  document.getElementById('resetIA').addEventListener('click', ()=>resetQuiz(quizIA,'quizIAContainer','scoreIA'));
  document.getElementById('resetRGPD').addEventListener('click', ()=>resetQuiz(quizRGPD,'quizRGPDContainer','scoreRGPD'));

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // Analyseur de prompt (heuristique p√©dagogique)
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  const patterns = {
    personal:[
      /\b(nom|pr√©nom|adresse|email|mail|e\-mail|t√©l√©phone|num√©ro|immatriculation|siret|sirene|siren|iban|carte|identit√©|identifiant|matricule)\b/gi,
      /\b\d{2}\/\d{2}\/\d{4}\b/g, // date JJ/MM/AAAA
      /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi,
      /\b\+?\d[\d\s().-]{7,}\b/g
    ],
    special:[
      /\b(sant√©|m√©dical|handicap|religion|croyance|politique|orientation\s+sexuelle|ethnie|racial|biom√©trie|donn√©es\s+g√©n√©tiques|syndical)\b/gi
    ],
    minors:[/\b(mineur|enfant|moins\s+de\s+18|coll√©gien|lyc√©en|√©l√®ve)\b/gi],
    profiling:[/\b(profilage|score|notation|classer|noter|√©valuer\s+des\s+personnes)\b/gi],
    biometrics:[/\b(reconnaissance\s+faciale|empreinte|iris|voix|biom√©trique|√©motion)\b/gi],
    publicSurv:[/\b(espace\s+public|vid√©osurveillance|cam√©ra\s+en\s+temps\s+r[√©e]el)\b/gi],
    transparency:[/\b(chatbot|assistant|conversationnel)\b/gi]
  };

  function analyzePrompt(text){
    const findings=[];
    const push = (type, msg)=> findings.push({type, msg});

    // Donn√©es personnelles
    if(patterns.personal.some(r=>r.test(text))){
      push('RGPD', 'Pr√©sence possible de donn√©es personnelles (identifiants, contacts, dates). Appliquez minimisation + base l√©gale.');
    }
    // Cat√©gories particuli√®res
    if(patterns.special.some(r=>r.test(text))){
      push('RGPD+', 'Cat√©gories particuli√®res d√©tect√©es (sant√©, religion, biom√©trie, etc.). N√©cessite conditions strictes.');
    }
    // Mineurs
    if(patterns.minors.some(r=>r.test(text))){
      push('Mineurs', 'R√©f√©rence √† des mineurs : protections renforc√©es, int√©r√™t sup√©rieur de l‚Äôenfant.');
    }
    // Profilage/notation
    if(patterns.profiling.some(r=>r.test(text))){
      push('Profilage', 'Attention au profilage/notation de personnes (risque √©lev√©, DPIA potentielle).');
    }
    // Biom√©trie
    if(patterns.biometrics.some(r=>r.test(text))){
      push('Biom√©trie', 'Reconnaissance biom√©trique/√©motionnelle : fortement encadr√©e, parfois interdite (IA Act).');
    }
    // Espace public/temps r√©el
    if(patterns.publicSurv.some(r=>r.test(text))){
      push('Surveillance', 'Surveillance en espace public/temps r√©el : peut relever des pratiques interdites.');
    }
    // Transparence chatbot
    if(patterns.transparency.some(r=>r.test(text))){
      push('Transparence', 'Interactions homme‚ÄëIA : informer clairement qu‚Äôil s‚Äôagit d‚Äôune IA (IA Act).');
    }

    // Conseils g√©n√©riques
    const tips = [
      '‚Ä¢ Limitez les donn√©es aux stricts besoins (minimisation).',
      '‚Ä¢ D√©finissez la finalit√© et la base l√©gale (RGPD).',
      '‚Ä¢ Pr√©f√©rez des identifiants anonymis√©s/pseudonymis√©s.',
      '‚Ä¢ Pr√©venez les biais : ajoutez un contr√¥le humain pour les d√©cisions importantes.',
      '‚Ä¢ Conservez les donn√©es le minimum de temps n√©cessaire.',
      '‚Ä¢ Informez les personnes lorsque c‚Äôest requis (transparence).'
    ];

    return {findings, tips};
  }

  function sanitizePrompt(text){
    // Remplacements simples pour anonymiser
    let out = text
      .replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi, '[EMAIL]')
      .replace(/\b\+?\d[\d\s().-]{7,}\b/g, '[TELEPHONE]')
      .replace(/\b([A-Z]{2}\d{2}[A-Z0-9]{11,30})\b/gi, '[IBAN]')
      .replace(/\b\d{2}\/\d{2}\/\d{4}\b/g, '[DATE]')
      .replace(/\b(siret|siren|sirene)\b/gi, '[IDENTIFIANT]')
      .replace(/\b(nom|pr√©nom)\b/gi, '[IDENTITE]')
      .replace(/\b(adresse|domicile)\b/gi, '[ADRESSE]');

    // Ajout de garde‚Äëfous (instructions conformes)
    const safeguards = `\n\n[Contraintes conformit√©]\n- Utiliser uniquement des donn√©es anonymis√©es/pseudonymis√©es.\n- √âvaluer les biais et fournir une explication claire et v√©rifiable.\n- Int√©grer une validation humaine avant toute d√©cision ayant un impact significatif.\n- Ne conserver aucun identifiant direct dans la sortie.\n- Mentionner que la r√©ponse est g√©n√©r√©e par une IA.`;

    return out.trim() + safeguards;
  }

  document.getElementById('sampleBtn').addEventListener('click', ()=>{
    document.getElementById('promptInput').value =
      'Classe ces CV et donne une note sur 100. Liste les meilleurs avec nom, email, √¢ge et √©tat de sant√©. Utilise la reconnaissance √©motionnelle sur les vid√©os des entretiens.';
  });

  document.getElementById('analyzeBtn').addEventListener('click', ()=>{
    const text = document.getElementById('promptInput').value || '';
    const box = document.getElementById('analysisBox');
    if(!text.trim()){
      box.innerHTML = '<div class="feedback hint">Entrez un prompt √† analyser.</div>';
      document.getElementById('rewriteBox').value='';
      return;
    }
    const {findings, tips} = analyzePrompt(text);

    if(findings.length===0){
      box.innerHTML = '<div class="feedback ok">‚úÖ Aucun indicateur de risque d√©tect√© par les r√®gles simples. V√©rifiez malgr√© tout la finalit√©, la minimisation et la base l√©gale.</div>';
    } else {
      box.innerHTML = `
        <div class="feedback ko"><strong>Risques d√©tect√©s :</strong>
          <ul style="margin:6px 0 0 18px">${findings.map(f=>`<li><span class="tag">${f.type}</span> ${f.msg}</li>`).join('')}</ul>
        </div>
        <div class="feedback hint" style="margin-top:10px"><strong>Conseils :</strong><br>${tips.join('<br>')}</div>
      `;
    }

    document.getElementById('rewriteBox').value = sanitizePrompt(text);
  });

  document.getElementById('copyRewrite').addEventListener('click', async ()=>{
    const txt = document.getElementById('rewriteBox').value;
    if(!txt) return;
    try{ await navigator.clipboard.writeText(txt); alert('R√©√©criture copi√©e dans le presse‚Äëpapiers.'); }catch(e){ alert('Copie impossible. S√©lectionnez et copiez manuellement.'); }
  });
  document.getElementById('clearAnalyzer').addEventListener('click', ()=>{
    document.getElementById('promptInput').value='';
    document.getElementById('analysisBox').innerHTML='<div class="muted">R√©sultats de l‚Äôanalyse s‚Äôaffichent ici.</div>';
    document.getElementById('rewriteBox').value='';
  });

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // Cas pratiques
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  const cases = [
    {id:'c1', prompt:"Transcris ces interviews et d√©tecte l‚Äô√©motion dominante de chaque candidat.", good:false, why:"La d√©tection des √©motions est un cas sensible pouvant √™tre prohib√©e (IA Act)."},
    {id:'c2', prompt:"R√©dige un r√©sum√© de cette politique interne sans inclure aucun nom ni email.", good:true, why:"Minimisation : pas de donn√©es personnelles directes dans le r√©sultat."},
    {id:'c3', prompt:"Rep√®re les fraudes en scannant en temps r√©el les visages film√©s dans notre magasin.", good:false, why:"Reconnaissance biom√©trique en temps r√©el en espace public : fortement encadr√©e/prohib√©e."},
    {id:'c4', prompt:"Nettoie ce jeu de donn√©es en rempla√ßant nom/pr√©nom/email par des identifiants al√©atoires.", good:true, why:"Pseudonymisation avant traitement : meilleure conformit√© RGPD."},
    {id:'c5', prompt:"Classe les dossiers d‚Äôaide sociale et bloque automatiquement ceux avec un score < 50.", good:false, why:"D√©cision automatis√©e √† fort impact sans contr√¥le humain : non conforme (RGPD & potentiellement haut risque IA Act)."},
    {id:'c6', prompt:"G√©n√®re un message et ajoute : ‚ÄòCe contenu est g√©n√©r√© par une IA‚Äô.", good:true, why:"Transparence envers l‚Äôutilisateur final."}
  ];

  // cas suppl√©mentaires (pour varier les entra√Ænements, sans modifier les cas existants)
  const extraCases = [
    {id:'c7', prompt:"Notre assistant de chat r√©pond aux usagers. Doit‚Äëil indiquer qu‚Äôil est une IA ?", good:true, why:"Obligation de transparence lorsque l‚Äôutilisateur interagit avec une IA."},
    {id:'c8', prompt:"Pour notre newsletter, collecte les scans de CNI afin de confirmer l‚Äôidentit√©.", good:false, why:"Collecte disproportionn√©e et tr√®s sensible ; pr√©f√©rer des moyens moins intrusifs et base l√©gale ad√©quate."},
    {id:'c9', prompt:"Remplace syst√©matiquement les noms et emails par des identifiants al√©atoires avant traitement.", good:true, why:"Pseudonymisation/minimisation favorables √† la conformit√©."},
    {id:'c10', prompt:"Analyse en temps r√©el les visages des passants pour d√©tecter les voleurs.", good:false, why:"Reconnaissance biom√©trique en espace public/temps r√©el : pratique g√©n√©ralement prohib√©e/fortement encadr√©e."}
  ];
  cases.push(...extraCases);

  function renderCases(){
    const el = document.getElementById('casesContainer');
    el.innerHTML='';
    cases.forEach((c, idx)=>{
      const wrap = document.createElement('div');
      wrap.className='q';
      wrap.innerHTML = `
        <div><strong>Cas ${idx+1}.</strong> ${c.prompt}</div>
        <div class="inline" style="margin-top:10px">
          <button class="btn good" data-ans="true" data-id="${c.id}">Conforme</button>
          <button class="btn bad" data-ans="false" data-id="${c.id}">Non conforme</button>
          <span id="casefb-${c.id}" class="feedback" hidden></span>
        </div>
      `;
      el.appendChild(wrap);
    });
  }
  renderCases();

  document.getElementById('casesContainer').addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-ans]');
    if(!btn) return;
    const id = btn.dataset.id;
    const ans = btn.dataset.ans === 'true';
    const ref = cases.find(x=>x.id===id);
    const fb = document.getElementById('casefb-'+id);
    const ok = ans === ref.good;
    fb.hidden=false; fb.className='feedback ' + (ok? 'ok':'ko');
    fb.textContent = (ok? '‚úÖ Correct. ':'‚ùå Incorrect. ') + ref.why;
  });

  document.getElementById('revealCases').addEventListener('click', ()=>{
    cases.forEach(c=>{
      const fb = document.getElementById('casefb-'+c.id);
      fb.hidden=false; fb.className='feedback hint';
      fb.textContent = (c.good? 'Conforme. ':'Non conforme. ') + c.why;
    });
  });
  document.getElementById('resetCases').addEventListener('click', renderCases);

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // Tableau de bord
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  function updateBoard(){
    const sIA = document.getElementById('scoreIA').textContent.match(/(\d+)\/(\d+)/);
    const sRG = document.getElementById('scoreRGPD').textContent.match(/(\d+)\/(\d+)/);
    const ia = sIA? [parseInt(sIA[1]), parseInt(sIA[2])] : [0,0];
    const rg = sRG? [parseInt(sRG[1]), parseInt(sRG[2])] : [0,0];
    document.getElementById('boardIA').textContent = ia[0] + '/' + ia[1];
    document.getElementById('boardRGPD').textContent = rg[0] + '/' + rg[1];
    document.getElementById('boardTotal').textContent = (ia[0]+rg[0]) + '/' + (ia[1]+rg[1]);
  }
  updateBoard();

  document.getElementById('resetAll').addEventListener('click', ()=>{
    resetQuiz(quizIA,'quizIAContainer','scoreIA');
    resetQuiz(quizRGPD,'quizRGPDContainer','scoreRGPD');
    renderCases();
    updateBoard();
  });

  // D√©marrage sur Accueil
  showSection('home');
    
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // Diagnostics (petits tests int√©gr√©s)
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  function runSelfTests(){
    const results = [];
    try{
      results.push(['Sections pr√©sentes', ['home','quiz-ia','quiz-rgpd','analyzer','cases','results'].every(id=>document.getElementById(id))]);
      results.push(['Boutons nav', document.querySelectorAll('nav button').length >= 6]);
      results.push(['Boutons go', document.querySelectorAll('[data-go]').length >= 1]);
      const hasListenerFix = (()=>{ let ok=false; const btn=document.querySelector('[data-go]'); if(btn){ const ds = btn.dataset.go; ok = !!ds; } return ok; })();
      results.push(['data-go lisible (dataset.go)', hasListenerFix]);
      const hasCases = (()=>{ const c = document.getElementById('casesContainer'); return !!(c && c.children && c.children.length>0); })();
      results.push(['Cas pratiques peupl√©s', hasCases]);
    }catch(e){ console.error(e); results.push(['Exception', false]); }

    const okAll = results.every(r=>r[1]);
    const panel = document.getElementById('diagnosticsPanel');
    if(panel){
      panel.innerHTML = `<div class="feedback ${okAll?'ok':'ko'}"><strong>Diagnostics :</strong><br>${results.map(r=>`‚Ä¢ ${r[0]} : ${r[1]?'OK':'KO'}`).join('<br>')}</div>`;
    } else {
      console.log('Diagnostics', results);
    }
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    const btn = document.getElementById('runDiagnostics');
    if(btn){ btn.addEventListener('click', runSelfTests); }
  });

  </script>
</body>
</html>
